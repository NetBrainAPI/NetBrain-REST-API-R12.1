
# Get Running Status of Trigger Task and Running ResultID of NI API Design

## ***POST*** V3/TAF/Lite/result
This API is used to retrieve Trigger Intent List and Intent Ezecution Result ID.

## Detail Information

> **Title** : Get Running Status of Trigger Task and Running ResultID of NI<br>

> **Version** : 17/07/2024

> **API Server URL** : http(s):// IP address of your NetBrain Web API Server/ServicesAPI/API/V3/TAF/Lite/result

> **Authentication** : 

|**Type**|**In**|**Name**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
|Bearer Authentication| Headers | Authentication token | 

## Request body(****required***)
|**Name**|**Type**|**Description**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
|||* - required<br />^ - optional|
|endpoint*|string|The endpoint generated by the system when the user adds an ADT view to TAF Lite. |
|taskId*|string|This ID can be obtained in the `reponse` from the API used to trigger intent (from the previous API return value). |


> ***Example***
```python
{
    "endpoint": "T1234",
    "taskId": "asdfb21-f795-486d-a5ac-9c48e76a6a87",
}
```

## Parameters(****required***)
>No parameters required.


## Headers

> **Data Format Headers**

|**Name**|**Type**|**Description**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
| Content-Type | string  | support "application/json" |
| Accept | string  | support "application/json" |

> **Authorization Headers**

|**Name**|**Type**|**Description**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
| token | string  | Authentication token, get from login API. |

## Response

|**Name**|**Type**|**Description**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
|taskId|string|task ID for the intent execution.|
|status|string|The execution status of this task <br />`0` - Pending <br />`1` - Running <br />`2` - Finished <br />Only when status is Finished, the following `intents` will have results|
|intents|list of objects|List of trigger network intents.|
|intents[].id|string|Intent ID|
|intents[].name|string|Intent Name|
|intents[].resultId|string|Intent Execution Result ID|
|intents[].hasAlert|boolean|Alert Status from Intent Execution Result. <br> `False` - no alert <br>`True` - there exists at least one alert|
|statusCode| integer | The returned status code of executing the API.  |
|statusDescription| string | The explanation of the status code.  |

> ***Example 1***
```python

{
    taskId: 'xxxxx1',
    status: 2, //0: pending, 1: running, 2: finished
    intents: [{
        id: 'xxxx1-111',
        name: 'intent1 name',
        resultId: 'yyyy1-111',
        hasAlert: true
    }, {
        id: 'xxxx1-222',
        name: 'intent2 name',
        resultId: 'yyyy2-2222',
        hasAlert: false
    }]
}
```


> ***Example 2***
```python
{
  "taskId": "aa422a38-f795-486d-a5ac-9c48e76a6a87",
  "status": 2,
  "statusMessage": "Finished",
  "intents": [
    {
      "id": "b8db8ae9-ef2d-5d6b-0ddd-5110bec4347a",
      "name": "TestDataView0001"
    },
    {
      "id": "4caea2ce-526c-4763-ba24-601be811b641",
      "name": "Demo01"
    },
    {
      "id": "0ca0f60a-6936-49fb-8fb2-ab47f4cb6956",
      "name": "test output map"
    }
  ],
  "statusCode": 790200,
  "statusDescription": "Success."
}
```

# Full Example:

```python
# import python modules 
import requests
import json
import time
import requests.packages.urllib3 as urllib3
 
urllib3.disable_warnings()
 
user = "abc"
pwd = "1234"
host_url = "http://10.10.0.29"
headers = {'Content-Type': 'application/json', 'Accept': 'application/json'}

# Get token for netbrain
def getTokens(user,password):
    login_api_url = r"/ServicesAPI/API/V1/Session"
    Login_url = host_url + login_api_url
    data = {
        "username": user,
        "password": password
    }
    token = requests.post(Login_url, data=json.dumps(
        data), headers=headers, verify=False)
    if token.status_code == 200:
        print(token.json())
        return token.json()["token"]
    else:
        print("Failed to get token with log:", token.error)
        return None

 
def get_lite_run_result(API_Body):
    # Trigger API url
    API_URL = r"/ServicesAPI/API/V3/TAF/Lite/result"
    # Trigger API payload
    print(headers)
    api_full_url = host_url + API_URL
    api_result = requests.post(api_full_url, data=json.dumps(
        API_Body), headers=headers, verify=False)
    if api_result.status_code == 200:
        return api_result.json()
    else:
        return api_result.json()
 
if __name__ =="__main__":
    API_BODY = {
        "endpoint": "T100007",
        "taskId": "aa422a38-f795-486d-a5ac-9c48e76a6a87",
    }

    try:
        # get token
        token = getTokens(user,pwd)
        if token:
            headers["Token"] = token
            print(get_lite_run_result(API_BODY))
    except Exception as e:
        print (str(e)) 


```

# cURL Code from Postman

```python
# call login API
curl -X POST \
http://10.10.0.29/ServicesAPI/API/V1/Session \
  -H 'Content-Type: application/json' \
  -H 'Accept: application/json' \
  -d '{
    "username" : "abc",
    "password" : "1234"  
}'

# call Get Running Status of Trigger Task and Running ResultID of NI
curl -X POST \
  http://10.10.0.29/ServicesAPI/API/V3/TAF/Lite/result \
  -H "Content-Type: application/json"
  -H 'token: 016c8f59-d27c-4d84-b1fb-8031d70e6297' \
  -d '{
        "endpoint": "T100007",
        "taskId": "aa422a38-f795-486d-a5ac-9c48e76a6a87",
    }'
```
