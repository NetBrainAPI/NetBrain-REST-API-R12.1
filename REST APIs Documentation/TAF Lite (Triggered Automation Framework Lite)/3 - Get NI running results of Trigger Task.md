
# Get NI running results of Trigger Task API Design

## ***POST*** V3/TAF/Lite/result/datas
This API is used to obtain the list of triggered intents and the execution results. <br>
PA license is required to use this API.

## Detail Information

> **Title** : Get NI running results of Trigger Task<br>

> **Version** : 17/07/2024

> **API Server URL** : http(s):// IP address of your NetBrain Web API Server/ServicesAPI/API/V3/TAF/Lite/result/datas

> **Authentication** : 

|**Type**|**In**|**Name**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
|Bearer Authentication| Headers | Authentication token | 

## Request body(****required***)
|**Name**|**Type**|**Description**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
|||* - required<br />^ - optional|
|endpoint*|string|The endpoint generated by the system when the user adds an ADT view to TAF Lite. |
|niResultId*|string|NI result ID; corresponds to `_id` of NIExecutionResult |
|output*|array|<table><tr><th>Value</th><th>Enum</th><th>Description</th></tr> <tr><td>0</td><td>all</td><td>All data, except raw data</td></tr> <tr><td>1</td><td>status_code</td><td>Status code and message</td></tr> <tr><td>2</td><td>raw_data</td><td>Raw data</td></tr> <tr><td>3</td><td>csv</td><td>CSV file</td></tr> <tr><td>4</td><td>map</td><td>Map ID, map name, and map link</td></tr> </table>|

> ***Example***
```python
{ 
   endpoint: 'endpoint1',
   niResultId: 'ni result id1',
   output: [0, 1, 2, 3, 4] //0:all, 1: rawdata, 2: status code, 3: csv, 4: map
}
```

## Parameters(****required***)
>No parameters required.


## Headers

> **Data Format Headers**

|**Name**|**Type**|**Description**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
| Content-Type | string  | support "application/json" |
| Accept | string  | support "application/json" |

> **Authorization Headers**

|**Name**|**Type**|**Description**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
| token | string  | Authentication token, get from login API. |

## Response
The returned NI execution result content includes Home NI and Follow NI results, hence the result is of type List.

|**Name**|**Type**|**Description**|
|------|------|------|
|<img width=100/>|<img width=100/>|<img width=500/>|
|[].niId|string|Intent ID|
|[].niName|string|Intent name|
|[].niResultId|string|Intent result ID|
|[].timePoint|string|NI execution time point|
|[].statusCodes|list|NI status code|
|[].csvs|list of objects|NI results in CSV format|
|[].rawDatas|list of objects|Results obtained from executing commands on each device|
|[].rawDatas[].deviceName|string|Device name|
|[].rawDatas[].command|string|Command executed on the device|
|[].rawDatas[].rawData|string|Raw text data|
|[].maps|list of objects|Map results executed by NI|
|statusCode| integer | The returned status code of executing the API.  |
|statusDescription| string | The explanation of the status code.  |

> ***Example***

```python
[{
    "niId": "intent1 id",
    "niName": "intent1 name",
    "statusCodes": [
      "intent status code1",
      "intent status code2"
    ],
    "csvs": [ {
        "fileName": "csv file name1", 
        "csv": "a1,b1,c1"
      }],
    "rawDatas": [
      {
        "device": "BJ-R1", 
        "command": "show config",
        "rawData": "raw data1"
      }
    ],
    "maps": [
        {
            "id": "map id 1",
            "name": "map Name 1",
            "url": "map url 1",
            "type": "Intent Map" //Intent Map; External Map
        }
    ],
  "statusCode": 790200,
  "statusDescription": "Success."
}]
```

# Full Example:

```python
# import python modules 
import requests
import json
import time
import requests.packages.urllib3 as urllib3
 
urllib3.disable_warnings()
 
user = "abc"
pwd = "1234"
host_url = "http://10.10.0.29"
headers = {'Content-Type': 'application/json', 'Accept': 'application/json'}

# Get token for netbrain
def getTokens(user,password):
    login_api_url = r"/ServicesAPI/API/V1/Session"
    Login_url = host_url + login_api_url
    data = {
        "username": user,
        "password": password
    }
    token = requests.post(Login_url, data=json.dumps(
        data), headers=headers, verify=False)
    if token.status_code == 200:
        print(token.json())
        return token.json()["token"]
    else:
        print("Failed to get token with log:", token.error)
        return None


def get_lite_run_result_data(API_Body):
 
    # Trigger  API url
    API_URL = r"/ServicesAPI/API/V3/TAF/Lite/result/datas"
    # Trigger API payload
    print(headers)
    api_full_url = host_url + API_URL
    api_result = requests.post(api_full_url, data=json.dumps(
        API_Body), headers=headers, verify=False)
    if api_result.status_code == 200:
        return api_result.json()
    else:
        return api_result.json()
 
if __name__ =="__main__":
    API_BODY = {
        "endpoint": "T100007",
        "niResultId": "7d12d7f6-5b45-4ee7-aa37-11b0db991dfd",
        "output": [0]
    }
    try:
        # get token
        token = getTokens(user,pwd)
        if token:
            headers["Token"] = token
            print(get_lite_run_result_data(API_BODY))
    except Exception as e:
        print (str(e)) 

```

# cURL Code from Postman

```python
# call login API
curl -X POST \
http://10.10.0.29/ServicesAPI/API/V1/Session \
  -H 'Content-Type: application/json' \
  -H 'Accept: application/json' \
  -d '{
    "username" : "abc",
    "password" : "1234"  
}'

# call Get NI running results of Trigger Task
curl -X POST \
  http://10.10.0.29/ServicesAPI/API/V3/TAF/Lite/result/datas \
  -H "Content-Type: application/json"
  -H 'token: 32ef82d4-44a5-4b48-a089-97daf5e1d92e' \
  -d '{
        "endpoint": "T100007",
        "taskId": "aa422a38-f795-486d-a5ac-9c48e76a6a87",
    }'
```
